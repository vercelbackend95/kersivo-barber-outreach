import{j as n}from"./jsx-runtime.D_zvdyIk.js";import{r as b}from"./index.DiEladB3.js";const p="kersivo_shop_cart_v2",N=Object.freeze({items:[],isOpen:!1,subtotalPence:0,email:""}),r=globalThis.__KERSIVO_CART_STORE__??{state:{items:[],isOpen:!1,email:""},clientSnapshot:N,listeners:new Set,isHydrated:!1,storageListenerBound:!1};globalThis.__KERSIVO_CART_STORE__=r;function d(){r.clientSnapshot={items:r.state.items,isOpen:r.state.isOpen,subtotalPence:r.state.items.reduce((t,a)=>t+a.pricePence*a.quantity,0),email:r.state.email};for(const t of r.listeners)t()}function S(t){const a=String(t.productId??"").trim(),c=String(t.name??"").trim(),s=Math.max(0,Math.floor(Number(t.pricePence??0))),e=Math.max(1,Math.floor(Number(t.quantity??1)));return!a||!c?null:{productId:a,name:c,pricePence:s,imageUrl:t.imageUrl?String(t.imageUrl):void 0,quantity:e}}function h(){if(typeof window>"u")return[];try{const t=JSON.parse(window.localStorage.getItem(p)??"[]");return Array.isArray(t)?t.map(a=>S(a)).filter(a=>!!a):[]}catch{return[]}}function I(t){typeof window>"u"||window.localStorage.setItem(p,JSON.stringify(t))}function l(){typeof window>"u"||r.isHydrated||(r.state.items=h(),r.isHydrated=!0,d(),r.storageListenerBound||(window.addEventListener("storage",t=>{t.key===p&&(r.state.items=h(),d())}),r.storageListenerBound=!0))}function m(t){r.state.items=t,I(r.state.items),d()}function j(t){return l(),r.listeners.add(t),()=>{r.listeners.delete(t)}}function _(){return l(),r.clientSnapshot}function w(){return N}function C(t){l();const a=String(t.productId).trim(),c=String(t.name).trim(),s=Math.max(0,Math.floor(Number(t.pricePence))),e=Math.max(1,Math.floor(Number(t.quantity??1)));if(!a||!c)return;const i=r.state.items.findIndex(u=>u.productId===a);if(i===-1){m([...r.state.items,{productId:a,name:c,pricePence:s,imageUrl:t.imageUrl,quantity:e}]);return}const o=[...r.state.items];o[i]={...o[i],name:c,pricePence:s,imageUrl:t.imageUrl??o[i].imageUrl,quantity:o[i].quantity+e},m(o)}function P(t){l(),m(r.state.items.filter(a=>a.productId!==t))}function g(t,a){l();const c=Math.floor(Number(a)),s=[...r.state.items],e=s.findIndex(i=>i.productId===t);if(e!==-1){if(c<=0){s.splice(e,1),m(s);return}s[e]={...s[e],quantity:c},m(s)}}function E(){l(),r.state.isOpen=!0,d()}function x(){l(),r.state.isOpen=!1,d()}function v(){return b.useSyncExternalStore(j,_,w)}function y(t){return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(t/100)}function O(t){const a=t.dataset.productId?.trim(),c=t.dataset.productName?.trim(),s=Number(t.dataset.productPricePence),e=t.dataset.productImageUrl?.trim();return!a||!c||Number.isNaN(s)?null:{productId:a,name:c,pricePence:Math.max(0,Math.floor(s)),imageUrl:e||void 0,quantity:1}}function M(){const{items:t,subtotalPence:a,isOpen:c}=v(),s=t.reduce((e,i)=>e+i.quantity,0);return b.useEffect(()=>{const e=i=>{const o=i.target;if(!(o instanceof Element))return;const u=o.closest("[data-add-to-cart]");if(!u||!(u instanceof HTMLElement))return;const f=O(u);f&&(C(f),E())};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]),n.jsxs(n.Fragment,{children:[n.jsxs("aside",{className:`cart-drawer ${c?"cart-drawer--open":""}`,"aria-hidden":c?"false":"true",children:[n.jsx("button",{type:"button",className:"btn btn--ghost cart-drawer__close",onClick:x,children:"Close"}),n.jsx("h2",{children:"Cart"}),n.jsx("div",{className:"cart-items",children:t.length===0?n.jsx("p",{className:"muted",children:"Your cart is empty."}):t.map(e=>n.jsxs("article",{className:"cart-row",children:[n.jsxs("div",{className:"cart-row__content",children:[e.imageUrl?n.jsx("img",{src:e.imageUrl,alt:e.name,className:"cart-row__image",loading:"lazy"}):null,n.jsxs("div",{children:[n.jsx("p",{className:"cart-item-name",children:e.name}),n.jsxs("p",{className:"muted",children:[y(e.pricePence)," each"]})]})]}),n.jsxs("div",{className:"cart-row-actions",children:[n.jsx("button",{type:"button",className:"btn btn--ghost",onClick:()=>g(e.productId,e.quantity-1),children:"-"}),n.jsx("span",{children:e.quantity}),n.jsx("button",{type:"button",className:"btn btn--ghost",onClick:()=>g(e.productId,e.quantity+1),children:"+"}),n.jsx("button",{type:"button",className:"btn btn--secondary",onClick:()=>P(e.productId),children:"Remove"})]})]},e.productId))}),n.jsx("label",{className:"cart-email-label",htmlFor:"shop-cart-email",children:"Email for receipt"}),n.jsx("input",{id:"shop-cart-email",type:"email",autoComplete:"email",placeholder:"you@example.com",className:"cart-email-input"}),n.jsxs("p",{className:"cart-subtotal",children:["Subtotal: ",n.jsx("strong",{children:y(a)})]})]}),c?n.jsx("button",{type:"button",className:"cart-drawer__backdrop","aria-label":"Close cart drawer",onClick:x}):null,n.jsxs("span",{className:"cart-count-announcer","aria-live":"polite","aria-atomic":"true",children:["Cart has ",s," item",s===1?"":"s","."]})]})}export{M as default};
